
브라우저의 로컬스토리지와 세션스토리지는 굉장히 편리한 수단이죠. 간단한 데이터를 브라우저에 저장하고 언제든 손쉽게 꺼내쓸 수 있습니다. 

복잡하고 장황한 코드도 필요 없습니다. 한 줄이면 쉽게 처리 가능하죠.

아래처럼요.

  
```javascript

localStorage.setItem(storageName, JSON.stringify(storageData));

localStorage.getItem(storageName, JSON.stringify(storageData));

```
하지만, 구글 개발팀은 더 이상 사용을 권장하지 않는군요.

구글은 로컬스토리지보다는 캐시API나 IndexedDB를 사용할 것을 권장하고 있습니다.

물론, 구글과 모질라가 서비스워커를 주도적으로 개발했고, 캐시API는 서비스워커가 제공하는 기능이므로 구글이 캐시API 사용을 권장하는 것은 이해됩니다.

 캐시API는 사용이 어렵지도 않습니다. 하지만, 로컬스토리지만큼 사용이 편리하지는 않습니다. 간단한 데이터를 저장한다면 여전히 로컬스토리지가 훨씬 강점이 있습니다.

 하지만, 아래와 같은 단점도 있습니다.

 - 용량 제한이 있다. (사파이 5MB, 크롬/엣지/파이어폭스/오페라 10MB)

- 메인 스레드에서 동작하므로 저장하는 동안 메인 스레드가 작동하지 않는다.

- 서비스워커에서 접근할 수 없다.

조금 더 복잡하고 용량이 큰 데이터라면 캐시API나 IndexedDB를 사용하는 것이 낫습니다. 특히, css와 js, image 등의 정적인 자원은 캐시API를 활용해 서버 요청을 줄이면 더 쾌적한 환경을 제공할 수 있습니다.

### 캐시 API 

Cache API는 서비스워커에서 제공하는 것으로 네트워크로 불러 온 리소스 파일을 캐싱할 수 있습니다. 기존의 http 캐시와는 달리, 캐시 API는 여러 캐시 객체를 가질 수 있으며, 이 캐시 객체를 통해 캐시를 세밀하게 관리할 수 있습니다. 

이미지 전용 캐시, js 전용 캐시 하는 식으로 말이죠. 캐시 API는 서비스워커를 통해 접근할 수 있습니다. 

### indexedDB

네트워크로 불러 온 정적 리소스가 아니라, 수시로 변해야 하는 데이터라면 indexedDB가 적당합니다. 

indexedDB는 브라우저에 데이터베이스를 구축하는 것입니다. 트랜젝션 모델을 사용하며 데이터 색인을 통해 빠른 검색을 할 수 있습니다.

### 용량

사용 가능한 용량은 어떻게 될까요? 
x`
로컬스토리지와는 비교도 안되게 많은 용량을 저장할 수 있습니다. 사파리를 제외한 모던 브라우저에서는 용량을 수치로 제한하지 않습니다. 사용자 디바이스의 저장 용량에 따른 제한만이 있습니다.

| 브라우저 | 용량 |
|--|--|
| Chrome | - 사용자 디스크 용량의 60% <br>- [StorageManage API](https://developer.mozilla.org/en-US/docs/Web/API/StorageManager/estimate)를 활용해 저장할 수 있는 최대 용량을 확인할 수 있습니다. |
| Edge | 크로미움 엔진 기반이라 Chrome과 동일합니다. |
| Firefox | 빈 디스크 용량의 50%까지 저장할 수 있습니다. |
| Safari | 1GB까지 저장할 수 있습니다. 용량을 다 쓰면 허용 용량을 200MB 더 늘릴 것인지 물어보는 팝업이 생성됩니다. |


저 역시 최신 프로젝트에서 캐시API와 IndexedDB 사용을 고려하고 있습니다.
  

지도 서비스와 같은 대용량 이미지 뷰어를 제작해야 하는데요. 구글의 지도 서비스와 같은 맥락이라고 보시면 될 것 같습니다.

대용량의 이미지이지만 사용자는 이 대용량의 이미지를 매우 빠르게 로드하고 드래그 및 확대/축소해 보길 원합니다. 

답은 이미지를 아주 작게 조각내서 타일 이미지 맵을 만들 것입니다. 아래 그림과 같이 말이죠.

  
![이미지타일 개념도](/img/202101/map.png)

잘라진 타일 이미지는 브라우저 캐시에 저장할 것입니다. 그리고, 사용자가 이미지를 드래그 및 확대/축소할 때 서버로의 요청을 최대한 자제하고 캐시에 미리 저장된 이미지를 브라우저에 로드하는 식으로 제작하는 방법을 고려하고 있습니다.

물론, 대용량 이미지를 잘게 조각낼 경우 수많은 이미지 조각이 생성됩니다. 그 것도 사용자의 확대/축소 범위를 대략 14레벨 정도로 만들어서, 14종류의 레벨에 대응하는 이미지 조각을 저장/관리해야 합니다.
 

#### 참조

> 1) [Storage for the web](https://web.dev/storage-for-the-web/)<br>
> 2) [웹 저장소 개요](https://developers.google.com/web/fundamentals/instant-and-offline/web-storage?hl=ko)